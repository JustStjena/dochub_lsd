# Пример структуры репозитория для описания архитектуры v 2.0

**Цель примера:** Снизить порог вхождения в DocHub за счет внедрения типовых шаблонов структуры репозитория и меню DocHub для управления корпоративной архитектурой.

# Отличия от предыдущей версии
* Основным отличием от предыдущей версии является то, что в этой версии управление метамоделями выделено в отдельную папку **metamodels** с целью разделения архитектурных данных и структуры метамоделей. Планируется, что будет разработано два пайплайна. В случае изменения архитектурных данных, эти данные сразу будет ехать на прод, предварительно проверяя наличие ошибок в валидаторе. В случае изменения метамодели, будет проводиться ревью изменений, а только потом специально обученный человек завезет изменения в прод.
* Второе отличие заключается в том, что пример стал более функциональным. В него был внесено множество реально работающих алгоритмов.

# Суть примера
Существует множество различных подходов к описанию архитектуры компании. В нашей компании была выбрана методология TOGAF. При этом мы не пытаемся внедрить классическую методологию TOGAF, мы используем комбинированный подход, выбирая только те инструменты, которые закрывают наиболее критичные риски компании.

Согласно методологии TOGAF архитектура предприятия делится на 4 домена:

1. Бизнес-архитектура - описание бизнес-процессов компании
2. Информационная архитектура - описание архитектуры данных
3. Прикладная архитектура - описание архитектуры программных продуктов (системы, сервисы, приложения и т.д.)
4. Технологическая архитектура - описание архитектуры инфраструктуры

![TOGAF](./images/arch_approach.png)

Вся структура примера разработана под выбранную методологию с учетом нашего видения. В общем случае в данном репозитории мы ведем прикладную архитектур ровня ПА-L1, но если у системы нет своего репозитория, либо у архитектора несколько систем, то он может управлять в этом репозитории и уровнем ПА-L2.

## Файловая структура примера
* **application_arch** - в этой папке хранятся все данные, связанные с прикладной архитектурой, кроме контекстов. Контексты мы вынесли в отдельную папку artefacts. Детально про artefacts можно почитать ниже.
    * **reports** - в этой папке хранятся различные отчеты по системам.
    * **systems** - в этой папке хранятся данные по системам. Каждую систему мы описываем в своём файле и имя файла всегда соответствует имени системы. Идентификатор системы в общем случае представляет из себя доменное имя в виде: `<имя компании>.<имя бизнес-юнита>.<имя системы>`. Если вдруг у системы нет своего репозитория, то в этом файле мы также описываем runtime компоненты этой системы, что позволяет хранить всю информацию по системе в одном месте.    
* **artefacts** - в этой папке мы храним все артефакты по системам, например контексты мы храним в такой структуре: `./artefacts/<имя бизнес-юнита>/<имя контекста>`. Также здесь мы храним различные схемы по системам.
    * **common** - в этой папке хранится общий контекст ГК Болото.
    * **frog_paradise** - в этой папке хранится контекст БЮ Лягушачий рай.
* **business_arch** - в этой папке хранятся все данные, связанные с бизнес-архитектурой. На текущий момент мы не ведем в DocHub бизнес-архитектуру. Возможно, суда будем класть архитектурные скетчи, когда Рома закончит встраивать в DocHub https://excalidraw.com/
* **dictionaries** - вспомогательная папка для хранения справочной информации. Например, при заполнении системы встал вопрос по её статусе, и чтобы не дублировать каждый раз всю информацию по статусу мы сделали справочник статусов и в системе используем только идентификатор, а если нам нужна полная информация, то получаем её при помощи функции $lookup внутри запроса.
* **documentation** - в этой папке хранится общая документация. Мы пытались её размещать в различных папках, но в конце концов приняли решение сделать для неё отдельное место.
    * **glossary** - в этой папке хранится глоссарий ГК Болото.
    * **useful_links** - в этой папке хранятся полезные линки на внешние ресурсы. Это может быть Confluence, различные обучающие видео на YouTube и т.д.
    * **images** - в этой папке хранятся картинки для документации.
* **enterprise_arch** - это папка корпоративных архитекторов, сюда мы помещаем всю информацию, которая связана с развитием архитектуры в компании.
    * **adr** - в этой папке хранится реестр архитектурных решений
    * **processes** - в этой папке мы храним документацию по различным архитектурным процессам
    * **tools** - в этой папке хранится документация по инструментам архитектуры
        * **dochub** - в этой папке хранится документация по DocHub
    * **welcome** - в этой папке хранится документация, которая выводится при открытии DocHub (welcome page) 
* **images** - картинки для настоящей документации
* **information_arch** - в этой папке хранятся все данные, связанные с информационной архитектурой. На текущий момент мы в начале пути и сделали пока только прототип по управлению бизнес-сущностями на логическом уровне.
    * **business_entities** - в этой папке хранятся данные по бизнес-сущностям. Сама модель переехала в папку metamodels.
* **metamodels** - в этой папке хранятся все метамодели, а также дополнительные наборы данных и инструментов необходимых для разработки метaмоделей и их валидации.
    * **custom** - в этой папке хранится описание всех пользовательских матамоделей.
        * **business_entities** - в этой папке хранится описание модели по управлению бизнес-сущностями на логическом уровне.
        * **dictionaries** - в этой папке хранится матамодель описывающая структуру справочников.
        * **dochub_menu** - в этой папке хранится матамодель описывающая целевую структуру меню.
    * **datasets** - в этой папке хранятся все общие запросы (datasets).
    * **default** -  в этой папке хранятся все инструменты для расширения дефолтных метамоделей DocHub.
    * **jsonata** - в этой папке хранятся общие функции. Пример использования можно посмотреть [здесь](https://github.com/rpiontik/DocHubExamples/blob/main/src/jsonata_query_examples/jsonata_query_example.md).
    * **validators** - здесь мы описываем валидаторы, которые нужно выводить в общее меню проблем. В самой папке есть два вида примеров, это валидация через schema и валидация через проверку заполнения конкретных параметров. Пример использования для schema можно посмотреть [здесь](https://github.com/rpiontik/DocHubExamples/tree/main/src/validator_example).
* **standards** - это одна из ключевых папок, где мы храним архитектурные принципы и стандарты, которые обязательны к выполнению всеми командами
    * **arch_principles** - здесь у нас описаны архитектурные принципы и принципы информационной безопасности
    * **it_platforms** - здесь мы храним архитектурные стандарты по платформам, а также принятые нотации по кодированию
    * **patterns** - здесь мы описываем различные паттерны, которые могут использовать наши команды. В примере есть пример реализации одного из таких паттернов.
* **tech_arch** - в этой папке хранятся все данные, связанные с технологической архитектурой. Сейчас мы пока реализовали процесс управления развертыванием систем. Пример использования можно посмотреть [здесь](https://github.com/rpiontik/DocHubExamples/tree/main/src/deployment_units_management)
* **_root.yaml** - корневой файл для импорта
* **dochub.yaml** - корневой файл DocHub
* **README.md** - текущая документация

## Правила импорта yaml файлов
Импорт всех файлов делается только через `_root.yaml`. Это означает что при создании любой папки всегда нужно сначала добавлять `_root.yaml`, а уже внутри подключать файлы.
Такой подход позволяет очень быстро переструктурировать папки репозитория, а также избегать множественного импорта при подключении репозитория как подмодуль.

## Пример целевого меню
Мы не дождались пока Рома сделает кастомный вариант меню, поэтому в web версии переделали его по себя. Ниже наша версия такого меню:

![Menu](./images/menu_example.jpg)

Найти реализованный пример на базе entity можно здесь:
![Menu](./images/menu_dochub.jpg)


## Использование
Скачайте себе пример и "потыкайте" каждый пункт меню, думаю найдете что-нибудь интересное :-).
